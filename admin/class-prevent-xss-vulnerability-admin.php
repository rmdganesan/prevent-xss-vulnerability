<?php
/**
 * @package PreventXSSVulnerability\Admin
 */

class Prevent_XSS_Vulnerability_Admin {

	/**
	 * Initializes WordPress hooks
	 */
	function __construct() {
		add_action( 'admin_menu', array( $this, 'admin_menu' ) );
	}

  /**
   * Added Pages in Menu for Settings.
   *
   * @access public
   * @since 0.1
   *
   * @return void
   */
	public function admin_menu() {
		add_menu_page( 'Prevent XSS Vulnerability', 'Prevent XSS Vulnerability',
      'administrator', 'prevent-xss-vulnerability',
      array( $this, 'prevent_xss_vulnerability_settings' ), 'dashicons-shield'
    );
		add_submenu_page( 'prevent-xss-vulnerability', 'Prevent XSS Vulnerability',
      'Prevent XSS', 'administrator', 'prevent-xss-vulnerability',
      array( $this, 'prevent_xss_vulnerability_settings' )
    );
		add_submenu_page( 'prevent-xss-vulnerability',
      'Reflected Cross-site scripting Settings', 'Reflected XSS Settings',
      'administrator', 'prevent-reflected-xss-vulnerability-settings',
      array( $this, 'prevent_xss_vulnerability_reflected_settings_page' )
    );
		add_submenu_page( 'prevent-xss-vulnerability', 'About Cross-site scripting',
      'About XSS', 'administrator', 'prevent-xss-vulnerability-about',
      array( $this, 'prevent_xss_vulnerability_about' )
    );

    add_filter( 'plugin_action_links_' . PREVENT_XSS_VULNERABILITY_BASENAME,
      array( $this, 'settings_link' )
    );
	}

	/**
	 * Define what the Plugin can do and how to configure the settings
	 */
	public function prevent_xss_vulnerability_settings() {
		require_once(
      PREVENT_XSS_VULNERABILITY_PATH . 'admin/class-prevent-xss-vulnerability-settings.php'
    );
    new Prevent_XSS_Vulnerability_Settings();
	}

	/**
	 * Settings Page where user can change the Settings
	 * for XSS (Choose which params to encode and which to block)
	 */
	public function prevent_xss_vulnerability_reflected_settings_page() {
    require_once(
      PREVENT_XSS_VULNERABILITY_PATH . 'admin/class-prevent-xss-vulnerability-reflected-settings.php'
    );
    new Prevent_XSS_Vulnerability_Reflected_Settings();
	}

	/**
	 * Define what is XSS and types of XSS
	 */
	public function prevent_xss_vulnerability_about() {
    require_once(
      PREVENT_XSS_VULNERABILITY_PATH . 'admin/class-prevent-xss-vulnerability-about.php'
    );
    new Prevent_XSS_Vulnerability_About();
	}

  /**
   * Plugin About, Contact and Settings Link on the Plugin Page under
   * the Plugin Name.
   *
   * @access public
   * @since 0.1
   *
   * @param array $links
   *   Contains the Plugin Basic Link (Activate/Deactivate/Delete)
   *
   * @return array $links
   *   Returns the Plugin Basic Links and added some custome link for Settings,
   *   Contact and About.
   */
  public function settings_link( $links ) {
    $about = sprintf(
      __( '<a href="%s" title="About">About</a>', 'prevent-xss-vulnerability' ),
      'admin.php?page=prevent-xss-vulnerability-about'
    );
    $contact = sprintf(
      __( '<a href="%s" title="Contact">Contact</a>', 'prevent-xss-vulnerability' ),
      'https://www.yasglobal.com/#request-form'
    );
    $settings_link = sprintf(
      __( '<a href="%s" title="Settings">Settings</a>', 'prevent-xss-vulnerability' ),
      'admin.php?page=prevent-reflected-xss-vulnerability-settings'
    );
    array_unshift( $links, $settings_link );
    array_unshift( $links, $contact );
    array_unshift( $links, $about );
    return $links;
  }
}
